<!DOCTYPE html>
<html>
  <head>
    <title>B·∫£n ƒë·ªì √î nhi·ªÖm</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPvknvHgVsZtetv7yzm+dlxDggGyJyHXUGF//vCVrVLidwEqPQN5I+WAYuxKtIheERcA=="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQgpYcz1GZyEd7uaFJJFySgCYDGm8sh+BjnqWqPTC+dLGIJJ/PNyrHMEjvQm1JpoaWj1UyfYk5twykYwu8vVyQ=="
      crossorigin=""
    ></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f4f7fa;
        height: 100vh;
        display: flex;
      }

      .container {
        display: flex;
        width: 100%;
        height: 100vh;
      }

      .chat-panel {
        width: 40%;
        background-color: #ffffff;
        padding: 20px;
        border-right: 1px solid #ddd;
        display: flex;
        flex-direction: column;
      }

      .chat-panel h1 {
        margin-bottom: 10px; /* Gi·∫£m margin ƒë·ªÉ c√≥ th√™m kh√¥ng gian cho reply */
        font-size: 24px;
        color: #333;
      }

      form {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      label {
        font-weight: bold;
        margin-bottom: 10px;
      }

      pre {
        background-color: #f0f0f0;
        padding: 10px;
        border-radius: 8px;
        font-size: 13px;
        margin-bottom: 10px;
        overflow-x: auto;
      }

      textarea {
        flex: 1;
        padding: 10px;
        font-family: monospace;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 8px;
        resize: vertical;
        margin-bottom: 10px;
        background-color: #fcfcfc;
      }

      button {
        padding: 12px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
      }

      button:hover {
        background-color: #0056b3;
      }

      .error-message {
        color: red;
        margin-top: 10px;
      }

      .chatbot-reply {
        margin-top: 15px; /* Th√™m kho·∫£ng c√°ch ph√≠a tr√™n reply */
        padding: 10px;
        background-color: #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        color: #333;
        word-break: break-word; /* Tr√°nh tr√†n ch·ªØ */
      }

      .chatbot-reply b {
        font-weight: bold;
        margin-right: 5px;
      }

      .map-panel {
        width: 60%;
        position: relative;
        background-color: #eef1f4;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #map-container {
        width: 100%;
        height: 100%;
        border-left: 1px solid #ccc;
      }

      .placeholder {
        text-align: center;
        color: #999;
      }

      .placeholder img {
        max-width: 300px;
        opacity: 0.3;
      }

      @media (max-width: 768px) {
        .container {
          flex-direction: column;
        }
        .chat-panel,
        .map-panel {
          width: 100%;
          height: 50%;
        }
      }
      .chat-messages-container {
        flex-grow: 1;
        overflow-y: auto;
        padding-bottom: 10px; /* ƒê·ªÉ c√≥ kho·∫£ng tr·ªëng cho tin nh·∫Øn m·ªõi nh·∫•t */
      }

      .message {
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 8px;
        clear: both; /* ƒê·∫£m b·∫£o c√°c tin nh·∫Øn kh√¥ng b·ªã float ch·ªìng l√™n nhau */
      }

      .user-message {
        background-color: #e2f7cb;
        align-self: flex-end; /* ƒê·∫©y tin nh·∫Øn ng∆∞·ªùi d√πng sang ph·∫£i */
        float: right;
      }

      .bot-message {
        background-color: #f0f0f0;
        align-self: flex-start; /* ƒê·∫©y tin nh·∫Øn bot sang tr√°i */
        float: left;
      }

      .user-label,
      .bot-label {
        font-size: 0.8em;
        color: #777;
        margin-bottom: 3px;
        display: block;
      }

      .user-label {
        text-align: right;
      }

      .input-area {
        display: flex;
        margin-top: 10px;
      }

      .input-area textarea {
        flex-grow: 1;
        resize: none; /* NgƒÉn ng∆∞·ªùi d√πng k√©o thay ƒë·ªïi k√≠ch th∆∞·ªõc */
        border-radius: 8px 0 0 8px;
        border-right: none;
        margin-bottom: 0; /* Lo·∫°i b·ªè margin bottom m·∫∑c ƒë·ªãnh */
      }

      .input-area button {
        border-radius: 0 8px 8px 0;
        border-left: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="chat-panel">
        <h1>üí¨ Tr·ª£ l√Ω √î nhi·ªÖm</h1>
        <div class="chat-messages-container">
          {% if conversation %} {% for message in conversation %}
          <div
            class="message {% if message.sender == 'user' %}user-message{% else %}bot-message{% endif %}"
          >
            <span
              class="{% if message.sender == 'user' %}user-label{% else %}bot-label{% endif %}"
            >
              {% if message.sender == 'user' %}B·∫°n{% else %}Bot{% endif %}
            </span>
            {{ message.text | safe }}
          </div>
          {% endfor %} {% endif %}
        </div>
        <form method="POST">
          <div class="input-area">
            <textarea
              id="pollution_data"
              name="pollution_data"
              placeholder="Nh·∫≠p d·ªØ li·ªáu √¥ nhi·ªÖm d·∫°ng JSON ho·∫∑c c√¢u h·ªèi..."
              rows="3"
            ></textarea>
            <button type="submit">G·ª≠i</button>
          </div>
          {% if error_message %}
          <p class="error-message">{{ error_message }}</p>
          {% endif %}
        </form>
      </div>

      <div class="map-panel">
        {% if map_html %}
        <div id="map-container">{{ map_html | safe }}</div>
        {% else %}
        <div class="placeholder">
          <img
            src="https://cdn-icons-png.flaticon.com/512/854/854878.png"
            alt="Waiting for map..."
          />
          <p>Ch∆∞a c√≥ b·∫£n ƒë·ªì. Vui l√≤ng nh·∫≠p d·ªØ li·ªáu b√™n tr√°i üëà</p>
        </div>
        {% endif %}
      </div>
    </div>
  </body>
</html>
